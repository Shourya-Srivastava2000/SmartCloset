{"ast":null,"code":"'use strict';\n\nexports.__esModule = true;\n\nvar _extends = Object.assign || function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n\n  return target;\n};\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _actions = require('@appbaseio/reactivecore/lib/actions');\n\nvar _helper = require('@appbaseio/reactivecore/lib/utils/helper');\n\nvar _types = require('@appbaseio/reactivecore/lib/utils/types');\n\nvar _types2 = _interopRequireDefault(_types);\n\nvar _Title = require('../../styles/Title');\n\nvar _Title2 = _interopRequireDefault(_Title);\n\nvar _TagList = require('../../styles/TagList');\n\nvar _TagList2 = _interopRequireDefault(_TagList);\n\nvar _Container = require('../../styles/Container');\n\nvar _Container2 = _interopRequireDefault(_Container);\n\nvar _utils = require('../../utils');\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _objectWithoutProperties(obj, keys) {\n  var target = {};\n\n  for (var i in obj) {\n    if (keys.indexOf(i) >= 0) continue;\n    if (!Object.prototype.hasOwnProperty.call(obj, i)) continue;\n    target[i] = obj[i];\n  }\n\n  return target;\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (!self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n}\n\nvar TagCloud = function (_Component) {\n  _inherits(TagCloud, _Component);\n\n  function TagCloud(props) {\n    _classCallCheck(this, TagCloud);\n\n    var _this = _possibleConstructorReturn(this, _Component.call(this, props));\n\n    _initialiseProps.call(_this);\n\n    _this.state = {\n      currentValue: {},\n      options: props.options && props.options[props.dataField] ? props.options[props.dataField].buckets : []\n    };\n    _this.locked = false;\n    _this.type = 'term';\n    _this.internalComponent = props.componentId + '__internal';\n    props.setQueryListener(props.componentId, props.onQueryChange, null);\n    return _this;\n  }\n\n  TagCloud.prototype.componentWillMount = function componentWillMount() {\n    this.props.addComponent(this.internalComponent);\n    this.props.addComponent(this.props.componentId);\n    this.updateQueryOptions(this.props);\n    this.setReact(this.props);\n\n    if (this.props.selectedValue) {\n      this.setValue(this.props.selectedValue, true);\n    } else if (this.props.defaultSelected) {\n      this.setValue(this.props.defaultSelected, true);\n    }\n  };\n\n  TagCloud.prototype.componentWillReceiveProps = function componentWillReceiveProps(nextProps) {\n    var _this2 = this;\n\n    (0, _helper.checkPropChange)(this.props.react, nextProps.react, function () {\n      return _this2.setReact(nextProps);\n    });\n    (0, _helper.checkPropChange)(this.props.options, nextProps.options, function () {\n      _this2.setState({\n        options: nextProps.options[nextProps.dataField] ? nextProps.options[nextProps.dataField].buckets : []\n      });\n    });\n    (0, _helper.checkSomePropChange)(this.props, nextProps, ['size', 'sortBy'], function () {\n      return _this2.updateQueryOptions(nextProps);\n    });\n    (0, _helper.checkPropChange)(this.props.dataField, nextProps.dataField, function () {\n      _this2.updateQueryOptions(nextProps);\n\n      _this2.updateQuery(Object.keys(_this2.state.currentValue), nextProps);\n    });\n    var selectedValue = Object.keys(this.state.currentValue);\n\n    if (!nextProps.multiSelect) {\n      selectedValue = selectedValue.length && selectedValue[0] || '';\n    }\n\n    if (!(0, _helper.isEqual)(this.props.defaultSelected, nextProps.defaultSelected)) {\n      this.setValue(nextProps.defaultSelected, true, nextProps);\n    } else if (!(0, _helper.isEqual)(selectedValue, nextProps.selectedValue)) {\n      this.setValue(nextProps.selectedValue, true, nextProps);\n    }\n  };\n\n  TagCloud.prototype.componentWillUnmount = function componentWillUnmount() {\n    this.props.removeComponent(this.props.componentId);\n    this.props.removeComponent(this.internalComponent);\n  };\n\n  TagCloud.generateQueryOptions = function generateQueryOptions(props) {\n    var _queryOptions$aggs;\n\n    var queryOptions = (0, _helper.getQueryOptions)(props);\n    queryOptions.size = 0;\n    queryOptions.aggs = (_queryOptions$aggs = {}, _queryOptions$aggs[props.dataField] = {\n      terms: {\n        field: props.dataField,\n        size: props.size,\n        order: (0, _helper.getAggsOrder)(props.sortBy || 'asc')\n      }\n    }, _queryOptions$aggs);\n    return queryOptions;\n  };\n\n  TagCloud.prototype.render = function render() {\n    var _this3 = this;\n\n    var min = 0.8;\n    var max = 3;\n\n    if (this.props.isLoading && this.props.loader) {\n      return this.props.loader;\n    }\n\n    if (this.state.options.length === 0) {\n      return null;\n    }\n\n    var highestCount = 0;\n    this.state.options.forEach(function (item) {\n      highestCount = item.doc_count > highestCount ? item.doc_count : highestCount;\n    });\n    return _react2.default.createElement(_Container2.default, {\n      style: this.props.style,\n      className: this.props.className\n    }, this.props.title && _react2.default.createElement(_Title2.default, {\n      className: (0, _helper.getClassName)(this.props.innerClass, 'title') || null\n    }, this.props.title), _react2.default.createElement(_TagList2.default, {\n      className: (0, _helper.getClassName)(this.props.innerClass, 'list') || null\n    }, this.state.options.map(function (item) {\n      var size = item.doc_count / highestCount * (max - min) + min;\n      return _react2.default.createElement('span', {\n        key: item.key,\n        onClick: function onClick() {\n          return _this3.setValue(item.key);\n        },\n        onKeyPress: function onKeyPress(e) {\n          return (0, _helper.handleA11yAction)(e, function () {\n            return _this3.setValue(item.key);\n          });\n        },\n        style: {\n          fontSize: size + 'em'\n        },\n        className: _this3.state.currentValue[item.key] ? ((0, _helper.getClassName)(_this3.props.innerClass, 'input') || '') + ' active' : (0, _helper.getClassName)(_this3.props.innerClass, 'input'),\n        role: 'menuitem',\n        tabIndex: '0'\n      }, item.key, _this3.props.showCount && ' (' + item.doc_count + ')');\n    })));\n  };\n\n  return TagCloud;\n}(_react.Component);\n\nTagCloud.defaultQuery = function (value, props) {\n  var query = null;\n  var type = props.queryFormat === 'or' ? 'terms' : 'term';\n  type = props.multiSelect ? type : 'term';\n\n  if (value) {\n    var listQuery = void 0;\n\n    if (!props.multiSelect || props.queryFormat === 'or') {\n      var _type, _listQuery;\n\n      listQuery = (_listQuery = {}, _listQuery[type] = (_type = {}, _type[props.dataField] = value, _type), _listQuery);\n    } else {\n      // adds a sub-query with must as an array of objects for each term/value\n      var queryArray = value.map(function (item) {\n        var _type2, _ref;\n\n        return _ref = {}, _ref[type] = (_type2 = {}, _type2[props.dataField] = item, _type2), _ref;\n      });\n      listQuery = {\n        bool: {\n          must: queryArray\n        }\n      };\n    }\n\n    query = value.length ? listQuery : null;\n  }\n\n  return query;\n};\n\nvar _initialiseProps = function _initialiseProps() {\n  var _this4 = this;\n\n  this.setReact = function (props) {\n    var react = props.react;\n\n    if (react) {\n      var newReact = (0, _helper.pushToAndClause)(react, _this4.internalComponent);\n      props.watchComponent(props.componentId, newReact);\n    } else {\n      props.watchComponent(props.componentId, {\n        and: _this4.internalComponent\n      });\n    }\n  };\n\n  this.setValue = function (value) {\n    var isDefaultValue = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n    var props = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : _this4.props; // ignore state updates when component is locked\n\n    if (props.beforeValueChange && _this4.locked) {\n      return;\n    }\n\n    _this4.locked = true;\n    var currentValue = _this4.state.currentValue;\n    var finalValues = null;\n\n    if (props.multiSelect) {\n      if (isDefaultValue) {\n        finalValues = value;\n        currentValue = {};\n\n        if (value) {\n          value.forEach(function (item) {\n            currentValue[item] = true;\n          });\n        }\n      } else {\n        if (currentValue[value]) {\n          var _currentValue = currentValue,\n              del = _currentValue[value],\n              rest = _objectWithoutProperties(_currentValue, [value]);\n\n          currentValue = _extends({}, rest);\n        } else {\n          currentValue[value] = true;\n        }\n\n        finalValues = Object.keys(currentValue);\n      }\n    } else {\n      var _currentValue2;\n\n      currentValue = (_currentValue2 = {}, _currentValue2[value] = true, _currentValue2);\n      finalValues = value;\n    }\n\n    var performUpdate = function performUpdate() {\n      _this4.setState({\n        currentValue: currentValue\n      }, function () {\n        _this4.updateQuery(finalValues, props);\n\n        _this4.locked = false;\n        if (props.onValueChange) props.onValueChange(finalValues);\n      });\n    };\n\n    (0, _helper.checkValueChange)(props.componentId, finalValues, props.beforeValueChange, performUpdate);\n  };\n\n  this.updateQuery = function (value, props) {\n    var query = props.customQuery || TagCloud.defaultQuery;\n    props.updateQuery({\n      componentId: props.componentId,\n      query: query(value, props),\n      value: value,\n      label: props.filterLabel,\n      showFilter: props.showFilter,\n      URLParams: props.URLParams,\n      componentType: 'TAGCLOUD'\n    });\n  };\n\n  this.updateQueryOptions = function (props) {\n    var queryOptions = TagCloud.generateQueryOptions(props);\n    props.setQueryOptions(_this4.internalComponent, queryOptions);\n  };\n};\n\nTagCloud.propTypes = {\n  addComponent: _types2.default.funcRequired,\n  removeComponent: _types2.default.funcRequired,\n  setQueryListener: _types2.default.funcRequired,\n  setQueryOptions: _types2.default.funcRequired,\n  updateQuery: _types2.default.funcRequired,\n  watchComponent: _types2.default.funcRequired,\n  options: _types2.default.options,\n  selectedValue: _types2.default.selectedValue,\n  // component props\n  beforeValueChange: _types2.default.func,\n  className: _types2.default.string,\n  componentId: _types2.default.stringRequired,\n  customQuery: _types2.default.func,\n  dataField: _types2.default.stringRequired,\n  defaultSelected: _types2.default.stringOrArray,\n  filterLabel: _types2.default.string,\n  innerClass: _types2.default.style,\n  isLoading: _types2.default.bool,\n  loader: _types2.default.title,\n  multiSelect: _types2.default.bool,\n  onQueryChange: _types2.default.func,\n  onValueChange: _types2.default.func,\n  queryFormat: _types2.default.queryFormatSearch,\n  react: _types2.default.react,\n  showCount: _types2.default.bool,\n  showFilter: _types2.default.bool,\n  size: _types2.default.number,\n  sortBy: _types2.default.sortByWithCount,\n  style: _types2.default.style,\n  title: _types2.default.title,\n  URLParams: _types2.default.bool\n};\nTagCloud.defaultProps = {\n  className: null,\n  multiSelect: false,\n  queryFormat: 'or',\n  showFilter: true,\n  size: 100,\n  sortBy: 'asc',\n  style: {},\n  URLParams: false\n};\n\nvar mapStateToProps = function mapStateToProps(state, props) {\n  return {\n    options: state.aggregations[props.componentId],\n    selectedValue: state.selectedValues[props.componentId] && state.selectedValues[props.componentId].value || null,\n    isLoading: state.isLoading[props.componentId]\n  };\n};\n\nvar mapDispatchtoProps = function mapDispatchtoProps(dispatch) {\n  return {\n    addComponent: function addComponent(component) {\n      return dispatch((0, _actions.addComponent)(component));\n    },\n    removeComponent: function removeComponent(component) {\n      return dispatch((0, _actions.removeComponent)(component));\n    },\n    setQueryOptions: function setQueryOptions(component, props) {\n      return dispatch((0, _actions.setQueryOptions)(component, props));\n    },\n    setQueryListener: function setQueryListener(component, onQueryChange, beforeQueryChange) {\n      return dispatch((0, _actions.setQueryListener)(component, onQueryChange, beforeQueryChange));\n    },\n    updateQuery: function updateQuery(updateQueryObject) {\n      return dispatch((0, _actions.updateQuery)(updateQueryObject));\n    },\n    watchComponent: function watchComponent(component, react) {\n      return dispatch((0, _actions.watchComponent)(component, react));\n    }\n  };\n};\n\nexports.default = (0, _utils.connect)(mapStateToProps, mapDispatchtoProps)(TagCloud);","map":{"version":3,"sources":["C:/Users/porto/info340-code/pod/340/node_modules/@appbaseio/reactivesearch/lib/components/basic/TagCloud.js"],"names":["exports","__esModule","_extends","Object","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","_react","require","_react2","_interopRequireDefault","_actions","_helper","_types","_types2","_Title","_Title2","_TagList","_TagList2","_Container","_Container2","_utils","obj","default","_objectWithoutProperties","keys","indexOf","_classCallCheck","instance","Constructor","TypeError","_possibleConstructorReturn","self","ReferenceError","_inherits","subClass","superClass","create","constructor","value","enumerable","writable","configurable","setPrototypeOf","__proto__","TagCloud","_Component","props","_this","_initialiseProps","state","currentValue","options","dataField","buckets","locked","type","internalComponent","componentId","setQueryListener","onQueryChange","componentWillMount","addComponent","updateQueryOptions","setReact","selectedValue","setValue","defaultSelected","componentWillReceiveProps","nextProps","_this2","checkPropChange","react","setState","checkSomePropChange","updateQuery","multiSelect","isEqual","componentWillUnmount","removeComponent","generateQueryOptions","_queryOptions$aggs","queryOptions","getQueryOptions","size","aggs","terms","field","order","getAggsOrder","sortBy","render","_this3","min","max","isLoading","loader","highestCount","forEach","item","doc_count","createElement","style","className","title","getClassName","innerClass","map","onClick","onKeyPress","e","handleA11yAction","fontSize","role","tabIndex","showCount","Component","defaultQuery","query","queryFormat","listQuery","_type","_listQuery","queryArray","_type2","_ref","bool","must","_this4","newReact","pushToAndClause","watchComponent","and","isDefaultValue","undefined","beforeValueChange","finalValues","_currentValue","del","rest","_currentValue2","performUpdate","onValueChange","checkValueChange","customQuery","label","filterLabel","showFilter","URLParams","componentType","setQueryOptions","propTypes","funcRequired","func","string","stringRequired","stringOrArray","queryFormatSearch","number","sortByWithCount","defaultProps","mapStateToProps","aggregations","selectedValues","mapDispatchtoProps","dispatch","component","beforeQueryChange","updateQueryObject","connect"],"mappings":"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","sourcesContent":["'use strict';\n\nexports.__esModule = true;\n\nvar _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _actions = require('@appbaseio/reactivecore/lib/actions');\n\nvar _helper = require('@appbaseio/reactivecore/lib/utils/helper');\n\nvar _types = require('@appbaseio/reactivecore/lib/utils/types');\n\nvar _types2 = _interopRequireDefault(_types);\n\nvar _Title = require('../../styles/Title');\n\nvar _Title2 = _interopRequireDefault(_Title);\n\nvar _TagList = require('../../styles/TagList');\n\nvar _TagList2 = _interopRequireDefault(_TagList);\n\nvar _Container = require('../../styles/Container');\n\nvar _Container2 = _interopRequireDefault(_Container);\n\nvar _utils = require('../../utils');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _objectWithoutProperties(obj, keys) { var target = {}; for (var i in obj) { if (keys.indexOf(i) >= 0) continue; if (!Object.prototype.hasOwnProperty.call(obj, i)) continue; target[i] = obj[i]; } return target; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar TagCloud = function (_Component) {\n\t_inherits(TagCloud, _Component);\n\n\tfunction TagCloud(props) {\n\t\t_classCallCheck(this, TagCloud);\n\n\t\tvar _this = _possibleConstructorReturn(this, _Component.call(this, props));\n\n\t\t_initialiseProps.call(_this);\n\n\t\t_this.state = {\n\t\t\tcurrentValue: {},\n\t\t\toptions: props.options && props.options[props.dataField] ? props.options[props.dataField].buckets : []\n\t\t};\n\t\t_this.locked = false;\n\t\t_this.type = 'term';\n\t\t_this.internalComponent = props.componentId + '__internal';\n\t\tprops.setQueryListener(props.componentId, props.onQueryChange, null);\n\t\treturn _this;\n\t}\n\n\tTagCloud.prototype.componentWillMount = function componentWillMount() {\n\t\tthis.props.addComponent(this.internalComponent);\n\t\tthis.props.addComponent(this.props.componentId);\n\t\tthis.updateQueryOptions(this.props);\n\n\t\tthis.setReact(this.props);\n\n\t\tif (this.props.selectedValue) {\n\t\t\tthis.setValue(this.props.selectedValue, true);\n\t\t} else if (this.props.defaultSelected) {\n\t\t\tthis.setValue(this.props.defaultSelected, true);\n\t\t}\n\t};\n\n\tTagCloud.prototype.componentWillReceiveProps = function componentWillReceiveProps(nextProps) {\n\t\tvar _this2 = this;\n\n\t\t(0, _helper.checkPropChange)(this.props.react, nextProps.react, function () {\n\t\t\treturn _this2.setReact(nextProps);\n\t\t});\n\t\t(0, _helper.checkPropChange)(this.props.options, nextProps.options, function () {\n\t\t\t_this2.setState({\n\t\t\t\toptions: nextProps.options[nextProps.dataField] ? nextProps.options[nextProps.dataField].buckets : []\n\t\t\t});\n\t\t});\n\t\t(0, _helper.checkSomePropChange)(this.props, nextProps, ['size', 'sortBy'], function () {\n\t\t\treturn _this2.updateQueryOptions(nextProps);\n\t\t});\n\n\t\t(0, _helper.checkPropChange)(this.props.dataField, nextProps.dataField, function () {\n\t\t\t_this2.updateQueryOptions(nextProps);\n\t\t\t_this2.updateQuery(Object.keys(_this2.state.currentValue), nextProps);\n\t\t});\n\n\t\tvar selectedValue = Object.keys(this.state.currentValue);\n\n\t\tif (!nextProps.multiSelect) {\n\t\t\tselectedValue = selectedValue.length && selectedValue[0] || '';\n\t\t}\n\n\t\tif (!(0, _helper.isEqual)(this.props.defaultSelected, nextProps.defaultSelected)) {\n\t\t\tthis.setValue(nextProps.defaultSelected, true, nextProps);\n\t\t} else if (!(0, _helper.isEqual)(selectedValue, nextProps.selectedValue)) {\n\t\t\tthis.setValue(nextProps.selectedValue, true, nextProps);\n\t\t}\n\t};\n\n\tTagCloud.prototype.componentWillUnmount = function componentWillUnmount() {\n\t\tthis.props.removeComponent(this.props.componentId);\n\t\tthis.props.removeComponent(this.internalComponent);\n\t};\n\n\tTagCloud.generateQueryOptions = function generateQueryOptions(props) {\n\t\tvar _queryOptions$aggs;\n\n\t\tvar queryOptions = (0, _helper.getQueryOptions)(props);\n\t\tqueryOptions.size = 0;\n\t\tqueryOptions.aggs = (_queryOptions$aggs = {}, _queryOptions$aggs[props.dataField] = {\n\t\t\tterms: {\n\t\t\t\tfield: props.dataField,\n\t\t\t\tsize: props.size,\n\t\t\t\torder: (0, _helper.getAggsOrder)(props.sortBy || 'asc')\n\t\t\t}\n\t\t}, _queryOptions$aggs);\n\n\t\treturn queryOptions;\n\t};\n\n\tTagCloud.prototype.render = function render() {\n\t\tvar _this3 = this;\n\n\t\tvar min = 0.8;\n\t\tvar max = 3;\n\n\t\tif (this.props.isLoading && this.props.loader) {\n\t\t\treturn this.props.loader;\n\t\t}\n\n\t\tif (this.state.options.length === 0) {\n\t\t\treturn null;\n\t\t}\n\n\t\tvar highestCount = 0;\n\t\tthis.state.options.forEach(function (item) {\n\t\t\thighestCount = item.doc_count > highestCount ? item.doc_count : highestCount;\n\t\t});\n\n\t\treturn _react2.default.createElement(\n\t\t\t_Container2.default,\n\t\t\t{ style: this.props.style, className: this.props.className },\n\t\t\tthis.props.title && _react2.default.createElement(\n\t\t\t\t_Title2.default,\n\t\t\t\t{ className: (0, _helper.getClassName)(this.props.innerClass, 'title') || null },\n\t\t\t\tthis.props.title\n\t\t\t),\n\t\t\t_react2.default.createElement(\n\t\t\t\t_TagList2.default,\n\t\t\t\t{ className: (0, _helper.getClassName)(this.props.innerClass, 'list') || null },\n\t\t\t\tthis.state.options.map(function (item) {\n\t\t\t\t\tvar size = item.doc_count / highestCount * (max - min) + min;\n\n\t\t\t\t\treturn _react2.default.createElement(\n\t\t\t\t\t\t'span',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tkey: item.key,\n\t\t\t\t\t\t\tonClick: function onClick() {\n\t\t\t\t\t\t\t\treturn _this3.setValue(item.key);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tonKeyPress: function onKeyPress(e) {\n\t\t\t\t\t\t\t\treturn (0, _helper.handleA11yAction)(e, function () {\n\t\t\t\t\t\t\t\t\treturn _this3.setValue(item.key);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tstyle: { fontSize: size + 'em' },\n\t\t\t\t\t\t\tclassName: _this3.state.currentValue[item.key] ? ((0, _helper.getClassName)(_this3.props.innerClass, 'input') || '') + ' active' : (0, _helper.getClassName)(_this3.props.innerClass, 'input'),\n\t\t\t\t\t\t\trole: 'menuitem',\n\t\t\t\t\t\t\ttabIndex: '0'\n\t\t\t\t\t\t},\n\t\t\t\t\t\titem.key,\n\t\t\t\t\t\t_this3.props.showCount && ' (' + item.doc_count + ')'\n\t\t\t\t\t);\n\t\t\t\t})\n\t\t\t)\n\t\t);\n\t};\n\n\treturn TagCloud;\n}(_react.Component);\n\nTagCloud.defaultQuery = function (value, props) {\n\tvar query = null;\n\tvar type = props.queryFormat === 'or' ? 'terms' : 'term';\n\ttype = props.multiSelect ? type : 'term';\n\tif (value) {\n\t\tvar listQuery = void 0;\n\t\tif (!props.multiSelect || props.queryFormat === 'or') {\n\t\t\tvar _type, _listQuery;\n\n\t\t\tlistQuery = (_listQuery = {}, _listQuery[type] = (_type = {}, _type[props.dataField] = value, _type), _listQuery);\n\t\t} else {\n\t\t\t// adds a sub-query with must as an array of objects for each term/value\n\t\t\tvar queryArray = value.map(function (item) {\n\t\t\t\tvar _type2, _ref;\n\n\t\t\t\treturn _ref = {}, _ref[type] = (_type2 = {}, _type2[props.dataField] = item, _type2), _ref;\n\t\t\t});\n\t\t\tlistQuery = {\n\t\t\t\tbool: {\n\t\t\t\t\tmust: queryArray\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\tquery = value.length ? listQuery : null;\n\t}\n\treturn query;\n};\n\nvar _initialiseProps = function _initialiseProps() {\n\tvar _this4 = this;\n\n\tthis.setReact = function (props) {\n\t\tvar react = props.react;\n\n\t\tif (react) {\n\t\t\tvar newReact = (0, _helper.pushToAndClause)(react, _this4.internalComponent);\n\t\t\tprops.watchComponent(props.componentId, newReact);\n\t\t} else {\n\t\t\tprops.watchComponent(props.componentId, {\n\t\t\t\tand: _this4.internalComponent\n\t\t\t});\n\t\t}\n\t};\n\n\tthis.setValue = function (value) {\n\t\tvar isDefaultValue = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n\t\tvar props = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : _this4.props;\n\n\t\t// ignore state updates when component is locked\n\t\tif (props.beforeValueChange && _this4.locked) {\n\t\t\treturn;\n\t\t}\n\n\t\t_this4.locked = true;\n\t\tvar currentValue = _this4.state.currentValue;\n\n\t\tvar finalValues = null;\n\n\t\tif (props.multiSelect) {\n\t\t\tif (isDefaultValue) {\n\t\t\t\tfinalValues = value;\n\t\t\t\tcurrentValue = {};\n\t\t\t\tif (value) {\n\t\t\t\t\tvalue.forEach(function (item) {\n\t\t\t\t\t\tcurrentValue[item] = true;\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (currentValue[value]) {\n\t\t\t\t\tvar _currentValue = currentValue,\n\t\t\t\t\t    del = _currentValue[value],\n\t\t\t\t\t    rest = _objectWithoutProperties(_currentValue, [value]);\n\n\t\t\t\t\tcurrentValue = _extends({}, rest);\n\t\t\t\t} else {\n\t\t\t\t\tcurrentValue[value] = true;\n\t\t\t\t}\n\t\t\t\tfinalValues = Object.keys(currentValue);\n\t\t\t}\n\t\t} else {\n\t\t\tvar _currentValue2;\n\n\t\t\tcurrentValue = (_currentValue2 = {}, _currentValue2[value] = true, _currentValue2);\n\t\t\tfinalValues = value;\n\t\t}\n\n\t\tvar performUpdate = function performUpdate() {\n\t\t\t_this4.setState({\n\t\t\t\tcurrentValue: currentValue\n\t\t\t}, function () {\n\t\t\t\t_this4.updateQuery(finalValues, props);\n\t\t\t\t_this4.locked = false;\n\t\t\t\tif (props.onValueChange) props.onValueChange(finalValues);\n\t\t\t});\n\t\t};\n\n\t\t(0, _helper.checkValueChange)(props.componentId, finalValues, props.beforeValueChange, performUpdate);\n\t};\n\n\tthis.updateQuery = function (value, props) {\n\t\tvar query = props.customQuery || TagCloud.defaultQuery;\n\n\t\tprops.updateQuery({\n\t\t\tcomponentId: props.componentId,\n\t\t\tquery: query(value, props),\n\t\t\tvalue: value,\n\t\t\tlabel: props.filterLabel,\n\t\t\tshowFilter: props.showFilter,\n\t\t\tURLParams: props.URLParams,\n\t\t\tcomponentType: 'TAGCLOUD'\n\t\t});\n\t};\n\n\tthis.updateQueryOptions = function (props) {\n\t\tvar queryOptions = TagCloud.generateQueryOptions(props);\n\t\tprops.setQueryOptions(_this4.internalComponent, queryOptions);\n\t};\n};\n\nTagCloud.propTypes = {\n\taddComponent: _types2.default.funcRequired,\n\tremoveComponent: _types2.default.funcRequired,\n\tsetQueryListener: _types2.default.funcRequired,\n\tsetQueryOptions: _types2.default.funcRequired,\n\tupdateQuery: _types2.default.funcRequired,\n\twatchComponent: _types2.default.funcRequired,\n\toptions: _types2.default.options,\n\tselectedValue: _types2.default.selectedValue,\n\t// component props\n\tbeforeValueChange: _types2.default.func,\n\tclassName: _types2.default.string,\n\tcomponentId: _types2.default.stringRequired,\n\tcustomQuery: _types2.default.func,\n\tdataField: _types2.default.stringRequired,\n\tdefaultSelected: _types2.default.stringOrArray,\n\tfilterLabel: _types2.default.string,\n\tinnerClass: _types2.default.style,\n\tisLoading: _types2.default.bool,\n\tloader: _types2.default.title,\n\tmultiSelect: _types2.default.bool,\n\tonQueryChange: _types2.default.func,\n\tonValueChange: _types2.default.func,\n\tqueryFormat: _types2.default.queryFormatSearch,\n\treact: _types2.default.react,\n\tshowCount: _types2.default.bool,\n\tshowFilter: _types2.default.bool,\n\tsize: _types2.default.number,\n\tsortBy: _types2.default.sortByWithCount,\n\tstyle: _types2.default.style,\n\ttitle: _types2.default.title,\n\tURLParams: _types2.default.bool\n};\n\nTagCloud.defaultProps = {\n\tclassName: null,\n\tmultiSelect: false,\n\tqueryFormat: 'or',\n\tshowFilter: true,\n\tsize: 100,\n\tsortBy: 'asc',\n\tstyle: {},\n\tURLParams: false\n};\n\nvar mapStateToProps = function mapStateToProps(state, props) {\n\treturn {\n\t\toptions: state.aggregations[props.componentId],\n\t\tselectedValue: state.selectedValues[props.componentId] && state.selectedValues[props.componentId].value || null,\n\t\tisLoading: state.isLoading[props.componentId]\n\t};\n};\n\nvar mapDispatchtoProps = function mapDispatchtoProps(dispatch) {\n\treturn {\n\t\taddComponent: function addComponent(component) {\n\t\t\treturn dispatch((0, _actions.addComponent)(component));\n\t\t},\n\t\tremoveComponent: function removeComponent(component) {\n\t\t\treturn dispatch((0, _actions.removeComponent)(component));\n\t\t},\n\t\tsetQueryOptions: function setQueryOptions(component, props) {\n\t\t\treturn dispatch((0, _actions.setQueryOptions)(component, props));\n\t\t},\n\t\tsetQueryListener: function setQueryListener(component, onQueryChange, beforeQueryChange) {\n\t\t\treturn dispatch((0, _actions.setQueryListener)(component, onQueryChange, beforeQueryChange));\n\t\t},\n\t\tupdateQuery: function updateQuery(updateQueryObject) {\n\t\t\treturn dispatch((0, _actions.updateQuery)(updateQueryObject));\n\t\t},\n\t\twatchComponent: function watchComponent(component, react) {\n\t\t\treturn dispatch((0, _actions.watchComponent)(component, react));\n\t\t}\n\t};\n};\n\nexports.default = (0, _utils.connect)(mapStateToProps, mapDispatchtoProps)(TagCloud);"]},"metadata":{},"sourceType":"script"}