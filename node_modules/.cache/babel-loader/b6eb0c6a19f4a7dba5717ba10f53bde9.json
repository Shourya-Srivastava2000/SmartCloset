{"ast":null,"code":"Object.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _extends = Object.assign || function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n\n  return target;\n};\n\nexports.setQuery = setQuery;\nexports.updateQueryOptions = updateQueryOptions;\nexports.logQuery = logQuery;\nexports.logCombinedQuery = logCombinedQuery;\nexports.setStreaming = setStreaming;\nexports.setHeaders = setHeaders;\nexports.setPromotedResults = setPromotedResults;\nexports.executeQuery = executeQuery;\nexports.setQueryOptions = setQueryOptions;\nexports.updateQuery = updateQuery;\nexports.loadMore = loadMore;\nexports.setQueryListener = setQueryListener;\n\nvar _constants = require('../constants');\n\nvar _value = require('./value');\n\nvar _hits = require('./hits');\n\nvar _helper = require('../utils/helper');\n\nvar _analytics = require('../utils/analytics');\n\nvar _analytics2 = _interopRequireDefault(_analytics);\n\nvar _maps = require('./maps');\n\nvar _graphQL = require('../utils/graphQL');\n\nvar _graphQL2 = _interopRequireDefault(_graphQL);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _toConsumableArray(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  } else {\n    return Array.from(arr);\n  }\n}\n\nfunction setQuery(component, query) {\n  return {\n    type: _constants.SET_QUERY,\n    component: component,\n    query: query\n  };\n}\n\nfunction updateQueryOptions(component, options) {\n  return {\n    type: _constants.SET_QUERY_OPTIONS,\n    component: component,\n    options: options\n  };\n}\n\nfunction logQuery(component, query) {\n  return {\n    type: _constants.LOG_QUERY,\n    component: component,\n    query: query\n  };\n}\n\nfunction logCombinedQuery(component, query) {\n  return {\n    type: _constants.LOG_COMBINED_QUERY,\n    component: component,\n    query: query\n  };\n}\n\nfunction setLoading(component, isLoading) {\n  return {\n    type: _constants.SET_LOADING,\n    component: component,\n    isLoading: isLoading\n  };\n}\n\nfunction setError(component, error) {\n  return {\n    type: _constants.SET_ERROR,\n    component: component,\n    error: error\n  };\n}\n\nfunction setTimestamp(component, timestamp) {\n  return {\n    type: _constants.SET_TIMESTAMP,\n    component: component,\n    timestamp: timestamp\n  };\n}\n\nfunction setStreaming(component) {\n  var status = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n  var ref = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n  return {\n    type: _constants.SET_STREAMING,\n    component: component,\n    status: status,\n    ref: ref\n  };\n}\n\nfunction setHeaders(headers) {\n  return {\n    type: _constants.SET_HEADERS,\n    headers: headers\n  };\n}\n\nfunction setPromotedResults() {\n  var results = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  return {\n    type: _constants.SET_PROMOTED_RESULTS,\n    results: results\n  };\n}\n\nfunction setSearchId() {\n  var searchId = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n  return {\n    type: _constants.SET_SEARCH_ID,\n    searchId: searchId\n  };\n}\n\nfunction msearch(query, orderOfQueries) {\n  var appendToHits = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n  var isInternalComponent = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n  var appendToAggs = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : false;\n  return function (dispatch, getState) {\n    var _getState = getState(),\n        appbaseRef = _getState.appbaseRef,\n        config = _getState.config,\n        headers = _getState.headers,\n        queryListener = _getState.queryListener,\n        analytics = _getState.analytics,\n        selectedValues = _getState.selectedValues;\n\n    var searchHeaders = {};\n\n    if (config.analytics && !isInternalComponent) {\n      var searchValue = analytics.searchValue,\n          searchId = analytics.searchId;\n      var filterString = (0, _analytics2.default)(selectedValues);\n\n      if (searchId) {\n        searchHeaders = _extends({\n          'X-Search-Id': searchId\n        }, filterString && {\n          'X-Search-Filters': filterString\n        });\n      } else if (searchValue) {\n        searchHeaders = _extends({\n          'X-Search-Query': searchValue\n        }, filterString && {\n          'X-Search-Filters': filterString\n        });\n      }\n    }\n\n    orderOfQueries.forEach(function (component) {\n      dispatch(setLoading(component, true));\n    });\n\n    var handleTransformResponse = function handleTransformResponse(res) {\n      if (config.transformResponse && typeof config.transformResponse === 'function') {\n        return config.transformResponse(res);\n      }\n\n      return new Promise(function (resolve) {\n        return resolve(res);\n      });\n    };\n\n    var handleResponse = function handleResponse(res) {\n      var searchId = res._headers ? res._headers.get('X-Search-Id') : null;\n\n      if (searchId) {\n        dispatch(setSearchId(searchId));\n      }\n\n      if (res.promoted) {\n        dispatch(setPromotedResults(res.promoted));\n      } else {\n        dispatch(setPromotedResults());\n      }\n\n      orderOfQueries.forEach(function (component, index) {\n        var response = res.responses[index];\n\n        var _getState2 = getState(),\n            timestamp = _getState2.timestamp;\n\n        if (timestamp[component] === undefined || timestamp[component] < res._timestamp) {\n          if (response.hits) {\n            dispatch(setTimestamp(component, res._timestamp));\n            dispatch((0, _hits.updateHits)(component, response.hits, response.took, appendToHits));\n            dispatch(setLoading(component, false));\n          }\n\n          if (response.aggregations) {\n            dispatch((0, _hits.updateAggs)(component, response.aggregations, appendToAggs));\n          }\n        }\n      });\n    };\n\n    var handleError = function handleError(error) {\n      console.error(error);\n      orderOfQueries.forEach(function (component) {\n        if (queryListener[component] && queryListener[component].onError) {\n          queryListener[component].onError(error);\n        }\n\n        dispatch(setError(component, error));\n        dispatch(setLoading(component, false));\n      });\n    };\n\n    if (config.graphQLUrl) {\n      (0, _graphQL2.default)(config.graphQLUrl, config.url, config.credentials, config.app, query).then(function (res) {\n        return handleTransformResponse(res);\n      }).then(function (res) {\n        handleResponse(res);\n      }).catch(function (err) {\n        handleError(err);\n      });\n    } else {\n      appbaseRef.setHeaders(_extends({}, headers, searchHeaders));\n      appbaseRef.msearch({\n        type: config.type === '*' ? '' : config.type,\n        body: query\n      }).then(function (res) {\n        return handleTransformResponse(res);\n      }).then(function (res) {\n        handleResponse(res);\n      }).catch(function (err) {\n        handleError(err);\n      });\n    }\n  };\n}\n\nfunction executeQueryListener(listener, oldQuery, newQuery) {\n  if (listener && listener.onQueryChange) {\n    listener.onQueryChange(oldQuery, newQuery);\n  }\n}\n\nfunction executeQuery(componentId) {\n  var executeWatchList = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n  var mustExecuteMapQuery = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n  return function (dispatch, getState) {\n    var _getState3 = getState(),\n        queryLog = _getState3.queryLog,\n        stream = _getState3.stream,\n        appbaseRef = _getState3.appbaseRef,\n        config = _getState3.config,\n        mapData = _getState3.mapData,\n        watchMan = _getState3.watchMan,\n        dependencyTree = _getState3.dependencyTree,\n        queryList = _getState3.queryList,\n        queryOptions = _getState3.queryOptions,\n        queryListener = _getState3.queryListener;\n\n    var orderOfQueries = [];\n    var finalQuery = [];\n    var matchAllQuery = {\n      match_all: {}\n    };\n    var componentList = [componentId];\n\n    if (executeWatchList) {\n      var watchList = watchMan[componentId] || [];\n      componentList = [].concat(_toConsumableArray(componentList), _toConsumableArray(watchList));\n    }\n\n    componentList.forEach(function (component) {\n      var _buildQuery = (0, _helper.buildQuery)(component, dependencyTree, queryList, queryOptions),\n          queryObj = _buildQuery.queryObj,\n          options = _buildQuery.options;\n\n      var validOptions = ['aggs', 'from', 'sort'];\n\n      if (queryObj && !!Object.keys(queryObj).length || options && Object.keys(options).some(function (item) {\n        return validOptions.includes(item);\n      })) {\n        if (!queryObj || queryObj && !Object.keys(queryObj).length) {\n          queryObj = _extends({}, matchAllQuery);\n        }\n\n        var currentQuery = _extends({\n          query: _extends({}, queryObj)\n        }, options, queryOptions[component]);\n\n        var queryToLog = _extends({\n          query: _extends({}, queryObj)\n        }, options, queryOptions[component]);\n\n        var oldQuery = queryLog[component];\n\n        if (mustExecuteMapQuery || !(0, _helper.isEqual)(currentQuery, oldQuery)) {\n          orderOfQueries = [].concat(_toConsumableArray(orderOfQueries), [component]);\n          dispatch(logQuery(component, queryToLog));\n          var isMapComponent = Object.keys(mapData).includes(component);\n\n          if (isMapComponent && mapData[component].query) {\n            var existingQuery = currentQuery.query;\n            currentQuery.query = {\n              bool: {\n                must: [existingQuery, mapData[component].query]\n              }\n            };\n\n            if (!mapData[component].persistMapQuery) {\n              dispatch((0, _maps.updateMapData)(componentId, null, false));\n            }\n\n            var _getState4 = getState(),\n                combinedLog = _getState4.combinedLog;\n\n            if ((0, _helper.isEqual)(combinedLog[component], currentQuery)) return;\n            dispatch(logCombinedQuery(component, currentQuery));\n          }\n\n          executeQueryListener(queryListener[component], oldQuery, currentQuery);\n\n          if (stream[component] && stream[component].status) {\n            if (stream[component].ref) {\n              stream[component].ref.stop();\n            }\n\n            var ref = appbaseRef.searchStream({\n              type: config.type === '*' ? '' : config.type,\n              body: currentQuery\n            }, function (response) {\n              if (response._id) {\n                dispatch((0, _hits.pushToStreamHits)(component, response));\n              }\n            }, function (error) {\n              if (queryListener[component] && queryListener[component].onError) {\n                queryListener[component].onError(error);\n              }\n\n              console.warn(error);\n              dispatch(setError(component, error));\n              dispatch(setLoading(component, false));\n            });\n            dispatch(setStreaming(component, true, ref));\n          }\n\n          finalQuery = [].concat(_toConsumableArray(finalQuery), [{\n            preference: component\n          }, currentQuery]);\n        }\n      }\n    });\n\n    if (finalQuery.length) {\n      dispatch(msearch(finalQuery, orderOfQueries, false, componentId.endsWith('__internal')));\n    }\n  };\n}\n\nfunction setQueryOptions(component, queryOptions) {\n  var execute = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\n  return function (dispatch) {\n    dispatch(updateQueryOptions(component, queryOptions));\n\n    if (execute) {\n      dispatch(executeQuery(component, true));\n    }\n  };\n}\n\nfunction updateQuery(_ref) {\n  var componentId = _ref.componentId,\n      query = _ref.query,\n      value = _ref.value,\n      _ref$label = _ref.label,\n      label = _ref$label === undefined ? null : _ref$label,\n      _ref$showFilter = _ref.showFilter,\n      showFilter = _ref$showFilter === undefined ? true : _ref$showFilter,\n      _ref$URLParams = _ref.URLParams,\n      URLParams = _ref$URLParams === undefined ? false : _ref$URLParams,\n      _ref$componentType = _ref.componentType,\n      componentType = _ref$componentType === undefined ? null : _ref$componentType,\n      _ref$category = _ref.category,\n      category = _ref$category === undefined ? null : _ref$category;\n  var execute = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n  return function (dispatch) {\n    var queryToDispatch = query;\n\n    if (query && query.query) {\n      queryToDispatch = query.query;\n    }\n\n    if (!componentId.endsWith('__internal')) {\n      dispatch((0, _value.setValue)(componentId, value, label, showFilter, URLParams, componentType, category));\n    }\n\n    dispatch(setQuery(componentId, queryToDispatch));\n    if (execute) dispatch(executeQuery(componentId, true));\n  };\n}\n\nfunction loadMore(component, newOptions) {\n  var appendToHits = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\n  var appendToAggs = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n  return function (dispatch, getState) {\n    var store = getState();\n\n    var _buildQuery2 = (0, _helper.buildQuery)(component, store.dependencyTree, store.queryList, store.queryOptions),\n        queryObj = _buildQuery2.queryObj,\n        options = _buildQuery2.options;\n\n    var queryLog = store.queryLog;\n    if (!options) options = {};\n    options = _extends({}, options, newOptions);\n\n    if (!queryObj || queryObj && !Object.keys(queryObj).length) {\n      queryObj = {\n        match_all: {}\n      };\n    }\n\n    var currentQuery = _extends({\n      query: _extends({}, queryObj)\n    }, options);\n\n    if ((0, _helper.isEqual)(queryLog[component], currentQuery)) return;\n    dispatch(logQuery(component, currentQuery));\n    var finalQuery = [{\n      preference: component\n    }, currentQuery];\n    dispatch(msearch(finalQuery, [component], appendToHits, false, appendToAggs));\n  };\n}\n\nfunction setQueryListener(component, onQueryChange, onError) {\n  return {\n    type: _constants.SET_QUERY_LISTENER,\n    component: component,\n    onQueryChange: onQueryChange,\n    onError: onError\n  };\n}","map":{"version":3,"sources":["C:/Users/porto/info340-code/pod/340/node_modules/@appbaseio/reactivecore/lib/actions/query.js"],"names":["Object","defineProperty","exports","value","_extends","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","setQuery","updateQueryOptions","logQuery","logCombinedQuery","setStreaming","setHeaders","setPromotedResults","executeQuery","setQueryOptions","updateQuery","loadMore","setQueryListener","_constants","require","_value","_hits","_helper","_analytics","_analytics2","_interopRequireDefault","_maps","_graphQL","_graphQL2","obj","__esModule","default","_toConsumableArray","arr","Array","isArray","arr2","from","component","query","type","SET_QUERY","options","SET_QUERY_OPTIONS","LOG_QUERY","LOG_COMBINED_QUERY","setLoading","isLoading","SET_LOADING","setError","error","SET_ERROR","setTimestamp","timestamp","SET_TIMESTAMP","status","undefined","ref","SET_STREAMING","headers","SET_HEADERS","results","SET_PROMOTED_RESULTS","setSearchId","searchId","SET_SEARCH_ID","msearch","orderOfQueries","appendToHits","isInternalComponent","appendToAggs","dispatch","getState","_getState","appbaseRef","config","queryListener","analytics","selectedValues","searchHeaders","searchValue","filterString","forEach","handleTransformResponse","res","transformResponse","Promise","resolve","handleResponse","_headers","get","promoted","index","response","responses","_getState2","_timestamp","hits","updateHits","took","aggregations","updateAggs","handleError","console","onError","graphQLUrl","url","credentials","app","then","catch","err","body","executeQueryListener","listener","oldQuery","newQuery","onQueryChange","componentId","executeWatchList","mustExecuteMapQuery","_getState3","queryLog","stream","mapData","watchMan","dependencyTree","queryList","queryOptions","finalQuery","matchAllQuery","match_all","componentList","watchList","concat","_buildQuery","buildQuery","queryObj","validOptions","keys","some","item","includes","currentQuery","queryToLog","isEqual","isMapComponent","existingQuery","bool","must","persistMapQuery","updateMapData","_getState4","combinedLog","stop","searchStream","_id","pushToStreamHits","warn","preference","endsWith","execute","_ref","_ref$label","label","_ref$showFilter","showFilter","_ref$URLParams","URLParams","_ref$componentType","componentType","_ref$category","category","queryToDispatch","setValue","newOptions","store","_buildQuery2","SET_QUERY_LISTENER"],"mappings":"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","sourcesContent":["Object.defineProperty(exports,\"__esModule\",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};exports.setQuery=setQuery;exports.updateQueryOptions=updateQueryOptions;exports.logQuery=logQuery;exports.logCombinedQuery=logCombinedQuery;exports.setStreaming=setStreaming;exports.setHeaders=setHeaders;exports.setPromotedResults=setPromotedResults;exports.executeQuery=executeQuery;exports.setQueryOptions=setQueryOptions;exports.updateQuery=updateQuery;exports.loadMore=loadMore;exports.setQueryListener=setQueryListener;var _constants=require('../constants');var _value=require('./value');var _hits=require('./hits');var _helper=require('../utils/helper');var _analytics=require('../utils/analytics');var _analytics2=_interopRequireDefault(_analytics);var _maps=require('./maps');var _graphQL=require('../utils/graphQL');var _graphQL2=_interopRequireDefault(_graphQL);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i];}return arr2;}else{return Array.from(arr);}}function setQuery(component,query){return{type:_constants.SET_QUERY,component:component,query:query};}function updateQueryOptions(component,options){return{type:_constants.SET_QUERY_OPTIONS,component:component,options:options};}function logQuery(component,query){return{type:_constants.LOG_QUERY,component:component,query:query};}function logCombinedQuery(component,query){return{type:_constants.LOG_COMBINED_QUERY,component:component,query:query};}function setLoading(component,isLoading){return{type:_constants.SET_LOADING,component:component,isLoading:isLoading};}function setError(component,error){return{type:_constants.SET_ERROR,component:component,error:error};}function setTimestamp(component,timestamp){return{type:_constants.SET_TIMESTAMP,component:component,timestamp:timestamp};}function setStreaming(component){var status=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var ref=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;return{type:_constants.SET_STREAMING,component:component,status:status,ref:ref};}function setHeaders(headers){return{type:_constants.SET_HEADERS,headers:headers};}function setPromotedResults(){var results=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];return{type:_constants.SET_PROMOTED_RESULTS,results:results};}function setSearchId(){var searchId=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;return{type:_constants.SET_SEARCH_ID,searchId:searchId};}function msearch(query,orderOfQueries){var appendToHits=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var isInternalComponent=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var appendToAggs=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;return function(dispatch,getState){var _getState=getState(),appbaseRef=_getState.appbaseRef,config=_getState.config,headers=_getState.headers,queryListener=_getState.queryListener,analytics=_getState.analytics,selectedValues=_getState.selectedValues;var searchHeaders={};if(config.analytics&&!isInternalComponent){var searchValue=analytics.searchValue,searchId=analytics.searchId;var filterString=(0,_analytics2.default)(selectedValues);if(searchId){searchHeaders=_extends({'X-Search-Id':searchId},filterString&&{'X-Search-Filters':filterString});}else if(searchValue){searchHeaders=_extends({'X-Search-Query':searchValue},filterString&&{'X-Search-Filters':filterString});}}orderOfQueries.forEach(function(component){dispatch(setLoading(component,true));});var handleTransformResponse=function handleTransformResponse(res){if(config.transformResponse&&typeof config.transformResponse==='function'){return config.transformResponse(res);}return new Promise(function(resolve){return resolve(res);});};var handleResponse=function handleResponse(res){var searchId=res._headers?res._headers.get('X-Search-Id'):null;if(searchId){dispatch(setSearchId(searchId));}if(res.promoted){dispatch(setPromotedResults(res.promoted));}else{dispatch(setPromotedResults());}orderOfQueries.forEach(function(component,index){var response=res.responses[index];var _getState2=getState(),timestamp=_getState2.timestamp;if(timestamp[component]===undefined||timestamp[component]<res._timestamp){if(response.hits){dispatch(setTimestamp(component,res._timestamp));dispatch((0,_hits.updateHits)(component,response.hits,response.took,appendToHits));dispatch(setLoading(component,false));}if(response.aggregations){dispatch((0,_hits.updateAggs)(component,response.aggregations,appendToAggs));}}});};var handleError=function handleError(error){console.error(error);orderOfQueries.forEach(function(component){if(queryListener[component]&&queryListener[component].onError){queryListener[component].onError(error);}dispatch(setError(component,error));dispatch(setLoading(component,false));});};if(config.graphQLUrl){(0,_graphQL2.default)(config.graphQLUrl,config.url,config.credentials,config.app,query).then(function(res){return handleTransformResponse(res);}).then(function(res){handleResponse(res);}).catch(function(err){handleError(err);});}else{appbaseRef.setHeaders(_extends({},headers,searchHeaders));appbaseRef.msearch({type:config.type==='*'?'':config.type,body:query}).then(function(res){return handleTransformResponse(res);}).then(function(res){handleResponse(res);}).catch(function(err){handleError(err);});}};}function executeQueryListener(listener,oldQuery,newQuery){if(listener&&listener.onQueryChange){listener.onQueryChange(oldQuery,newQuery);}}function executeQuery(componentId){var executeWatchList=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var mustExecuteMapQuery=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;return function(dispatch,getState){var _getState3=getState(),queryLog=_getState3.queryLog,stream=_getState3.stream,appbaseRef=_getState3.appbaseRef,config=_getState3.config,mapData=_getState3.mapData,watchMan=_getState3.watchMan,dependencyTree=_getState3.dependencyTree,queryList=_getState3.queryList,queryOptions=_getState3.queryOptions,queryListener=_getState3.queryListener;var orderOfQueries=[];var finalQuery=[];var matchAllQuery={match_all:{}};var componentList=[componentId];if(executeWatchList){var watchList=watchMan[componentId]||[];componentList=[].concat(_toConsumableArray(componentList),_toConsumableArray(watchList));}componentList.forEach(function(component){var _buildQuery=(0,_helper.buildQuery)(component,dependencyTree,queryList,queryOptions),queryObj=_buildQuery.queryObj,options=_buildQuery.options;var validOptions=['aggs','from','sort'];if(queryObj&&!!Object.keys(queryObj).length||options&&Object.keys(options).some(function(item){return validOptions.includes(item);})){if(!queryObj||queryObj&&!Object.keys(queryObj).length){queryObj=_extends({},matchAllQuery);}var currentQuery=_extends({query:_extends({},queryObj)},options,queryOptions[component]);var queryToLog=_extends({query:_extends({},queryObj)},options,queryOptions[component]);var oldQuery=queryLog[component];if(mustExecuteMapQuery||!(0,_helper.isEqual)(currentQuery,oldQuery)){orderOfQueries=[].concat(_toConsumableArray(orderOfQueries),[component]);dispatch(logQuery(component,queryToLog));var isMapComponent=Object.keys(mapData).includes(component);if(isMapComponent&&mapData[component].query){var existingQuery=currentQuery.query;currentQuery.query={bool:{must:[existingQuery,mapData[component].query]}};if(!mapData[component].persistMapQuery){dispatch((0,_maps.updateMapData)(componentId,null,false));}var _getState4=getState(),combinedLog=_getState4.combinedLog;if((0,_helper.isEqual)(combinedLog[component],currentQuery))return;dispatch(logCombinedQuery(component,currentQuery));}executeQueryListener(queryListener[component],oldQuery,currentQuery);if(stream[component]&&stream[component].status){if(stream[component].ref){stream[component].ref.stop();}var ref=appbaseRef.searchStream({type:config.type==='*'?'':config.type,body:currentQuery},function(response){if(response._id){dispatch((0,_hits.pushToStreamHits)(component,response));}},function(error){if(queryListener[component]&&queryListener[component].onError){queryListener[component].onError(error);}console.warn(error);dispatch(setError(component,error));dispatch(setLoading(component,false));});dispatch(setStreaming(component,true,ref));}finalQuery=[].concat(_toConsumableArray(finalQuery),[{preference:component},currentQuery]);}}});if(finalQuery.length){dispatch(msearch(finalQuery,orderOfQueries,false,componentId.endsWith('__internal')));}};}function setQueryOptions(component,queryOptions){var execute=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;return function(dispatch){dispatch(updateQueryOptions(component,queryOptions));if(execute){dispatch(executeQuery(component,true));}};}function updateQuery(_ref){var componentId=_ref.componentId,query=_ref.query,value=_ref.value,_ref$label=_ref.label,label=_ref$label===undefined?null:_ref$label,_ref$showFilter=_ref.showFilter,showFilter=_ref$showFilter===undefined?true:_ref$showFilter,_ref$URLParams=_ref.URLParams,URLParams=_ref$URLParams===undefined?false:_ref$URLParams,_ref$componentType=_ref.componentType,componentType=_ref$componentType===undefined?null:_ref$componentType,_ref$category=_ref.category,category=_ref$category===undefined?null:_ref$category;var execute=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;return function(dispatch){var queryToDispatch=query;if(query&&query.query){queryToDispatch=query.query;}if(!componentId.endsWith('__internal')){dispatch((0,_value.setValue)(componentId,value,label,showFilter,URLParams,componentType,category));}dispatch(setQuery(componentId,queryToDispatch));if(execute)dispatch(executeQuery(componentId,true));};}function loadMore(component,newOptions){var appendToHits=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var appendToAggs=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;return function(dispatch,getState){var store=getState();var _buildQuery2=(0,_helper.buildQuery)(component,store.dependencyTree,store.queryList,store.queryOptions),queryObj=_buildQuery2.queryObj,options=_buildQuery2.options;var queryLog=store.queryLog;if(!options)options={};options=_extends({},options,newOptions);if(!queryObj||queryObj&&!Object.keys(queryObj).length){queryObj={match_all:{}};}var currentQuery=_extends({query:_extends({},queryObj)},options);if((0,_helper.isEqual)(queryLog[component],currentQuery))return;dispatch(logQuery(component,currentQuery));var finalQuery=[{preference:component},currentQuery];dispatch(msearch(finalQuery,[component],appendToHits,false,appendToAggs));};}function setQueryListener(component,onQueryChange,onError){return{type:_constants.SET_QUERY_LISTENER,component:component,onQueryChange:onQueryChange,onError:onError};}"]},"metadata":{},"sourceType":"script"}