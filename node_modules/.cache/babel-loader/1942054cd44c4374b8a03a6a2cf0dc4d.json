{"ast":null,"code":"'use strict';\n\nexports.__esModule = true;\n\nvar _emotion = require('emotion');\n\nvar _extends = Object.assign || function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n\n  return target;\n};\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _actions = require('@appbaseio/reactivecore/lib/actions');\n\nvar _helper = require('@appbaseio/reactivecore/lib/utils/helper');\n\nvar _types = require('@appbaseio/reactivecore/lib/utils/types');\n\nvar _types2 = _interopRequireDefault(_types);\n\nvar _utils = require('./utils');\n\nvar _Title = require('../../styles/Title');\n\nvar _Title2 = _interopRequireDefault(_Title);\n\nvar _Container = require('../../styles/Container');\n\nvar _Container2 = _interopRequireDefault(_Container);\n\nvar _Button = require('../../styles/Button');\n\nvar _Button2 = _interopRequireDefault(_Button);\n\nvar _Dropdown = require('../shared/Dropdown');\n\nvar _Dropdown2 = _interopRequireDefault(_Dropdown);\n\nvar _utils2 = require('../../utils');\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _objectWithoutProperties(obj, keys) {\n  var target = {};\n\n  for (var i in obj) {\n    if (keys.indexOf(i) >= 0) continue;\n    if (!Object.prototype.hasOwnProperty.call(obj, i)) continue;\n    target[i] = obj[i];\n  }\n\n  return target;\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (!self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n}\n\nvar MultiDropdownList = function (_Component) {\n  _inherits(MultiDropdownList, _Component);\n\n  function MultiDropdownList(props) {\n    _classCallCheck(this, MultiDropdownList);\n\n    var _this = _possibleConstructorReturn(this, _Component.call(this, props));\n\n    _initialiseProps.call(_this);\n\n    _this.state = {\n      currentValue: {},\n      options: [],\n      after: {},\n      // for composite aggs\n      isLastBucket: false\n    };\n    _this.locked = false;\n    _this.internalComponent = props.componentId + '__internal';\n    props.setQueryListener(props.componentId, props.onQueryChange, null);\n    return _this;\n  }\n\n  MultiDropdownList.prototype.componentWillMount = function componentWillMount() {\n    this.props.addComponent(this.internalComponent);\n    this.props.addComponent(this.props.componentId);\n    this.updateQueryOptions(this.props);\n    this.setReact(this.props);\n\n    if (this.props.selectedValue) {\n      this.setValue(this.props.selectedValue, true);\n    } else if (this.props.defaultSelected) {\n      this.setValue(this.props.defaultSelected, true);\n    }\n  };\n\n  MultiDropdownList.prototype.componentWillReceiveProps = function componentWillReceiveProps(nextProps) {\n    var _this2 = this;\n\n    (0, _helper.checkPropChange)(this.props.react, nextProps.react, function () {\n      return _this2.setReact(nextProps);\n    });\n    (0, _helper.checkPropChange)(this.props.options, nextProps.options, function () {\n      var showLoadMore = nextProps.showLoadMore,\n          dataField = nextProps.dataField;\n      var options = _this2.state.options;\n\n      if (showLoadMore) {\n        // append options with showLoadMore\n        var buckets = nextProps.options[dataField].buckets;\n        var nextOptions = [].concat(options, buckets.map(function (bucket) {\n          return {\n            key: bucket.key[dataField],\n            doc_count: bucket.doc_count\n          };\n        }));\n        var after = nextProps.options[dataField].after_key; // detect the last bucket by checking if the next set of buckets were empty\n\n        var isLastBucket = !buckets.length;\n\n        _this2.setState({\n          after: {\n            after: after\n          },\n          isLastBucket: isLastBucket,\n          options: nextOptions\n        });\n      } else {\n        _this2.setState({\n          options: nextProps.options[nextProps.dataField] ? nextProps.options[nextProps.dataField].buckets : []\n        });\n      }\n    });\n    (0, _helper.checkSomePropChange)(this.props, nextProps, ['size', 'sortBy'], function () {\n      return _this2.updateQueryOptions(nextProps);\n    });\n    (0, _helper.checkPropChange)(this.props.dataField, nextProps.dataField, function () {\n      _this2.updateQueryOptions(nextProps);\n\n      _this2.updateQuery(Object.keys(_this2.state.currentValue), nextProps);\n    });\n    var selectedValue = Object.keys(this.state.currentValue);\n\n    if (this.props.selectAllLabel) {\n      selectedValue = selectedValue.filter(function (val) {\n        return val !== _this2.props.selectAllLabel;\n      });\n\n      if (this.state.currentValue[this.props.selectAllLabel]) {\n        selectedValue = [this.props.selectAllLabel];\n      }\n    }\n\n    if (!(0, _helper.isEqual)(this.props.defaultSelected, nextProps.defaultSelected)) {\n      this.setValue(nextProps.defaultSelected, true);\n    } else if (!(0, _helper.isEqual)(selectedValue, nextProps.selectedValue)) {\n      this.setValue(nextProps.selectedValue || [], true);\n    }\n  };\n\n  MultiDropdownList.prototype.componentWillUnmount = function componentWillUnmount() {\n    this.props.removeComponent(this.props.componentId);\n    this.props.removeComponent(this.internalComponent);\n  };\n\n  MultiDropdownList.generateQueryOptions = function generateQueryOptions(props, after) {\n    var queryOptions = (0, _helper.getQueryOptions)(props);\n    return props.showLoadMore ? (0, _utils.getCompositeAggsQuery)(queryOptions, props, after) : (0, _utils.getAggsQuery)(queryOptions, props);\n  };\n\n  MultiDropdownList.prototype.render = function render() {\n    var _props = this.props,\n        showLoadMore = _props.showLoadMore,\n        loadMoreLabel = _props.loadMoreLabel;\n    var isLastBucket = this.state.isLastBucket;\n    var selectAll = [];\n\n    if (this.props.isLoading && this.props.loader) {\n      return this.props.loader;\n    }\n\n    if (this.state.options.length === 0) {\n      return null;\n    }\n\n    if (this.props.selectAllLabel) {\n      selectAll = [{\n        key: this.props.selectAllLabel\n      }];\n    }\n\n    return _react2.default.createElement(_Container2.default, {\n      style: this.props.style,\n      className: this.props.className\n    }, this.props.title && _react2.default.createElement(_Title2.default, {\n      className: (0, _helper.getClassName)(this.props.innerClass, 'title') || null\n    }, this.props.title), _react2.default.createElement(_Dropdown2.default, {\n      innerClass: this.props.innerClass,\n      items: [].concat(selectAll, this.state.options.filter(function (item) {\n        return String(item.key).trim().length;\n      }).map(function (item) {\n        return _extends({}, item, {\n          key: String(item.key)\n        });\n      })),\n      onChange: this.setValue,\n      selectedItem: this.state.currentValue,\n      placeholder: this.props.placeholder,\n      labelField: 'key',\n      multi: true,\n      showCount: this.props.showCount,\n      themePreset: this.props.themePreset,\n      renderListItem: this.props.renderListItem,\n      showSearch: this.props.showSearch,\n      transformData: this.props.transformData,\n      footer: showLoadMore && !isLastBucket && _react2.default.createElement('div', {\n        className: (0, _emotion.css)(_Button.loadMoreContainer)\n      }, _react2.default.createElement(_Button2.default, {\n        onClick: this.handleLoadMore\n      }, loadMoreLabel))\n    }));\n  };\n\n  return MultiDropdownList;\n}(_react.Component);\n\nMultiDropdownList.defaultQuery = function (value, props) {\n  var query = null;\n  var type = props.queryFormat === 'or' ? 'terms' : 'term';\n\n  if (!Array.isArray(value) || value.length === 0) {\n    return null;\n  }\n\n  if (props.selectAllLabel && value.includes(props.selectAllLabel)) {\n    if (props.showMissing) {\n      query = {\n        match_all: {}\n      };\n    } else {\n      query = {\n        exists: {\n          field: props.dataField\n        }\n      };\n    }\n  } else if (value) {\n    var listQuery = void 0;\n\n    if (props.queryFormat === 'or') {\n      if (props.showMissing) {\n        var _type, _ref;\n\n        var hasMissingTerm = value.includes(props.missingLabel);\n        var should = [(_ref = {}, _ref[type] = (_type = {}, _type[props.dataField] = value.filter(function (item) {\n          return item !== props.missingLabel;\n        }), _type), _ref)];\n\n        if (hasMissingTerm) {\n          should = should.concat({\n            bool: {\n              must_not: {\n                exists: {\n                  field: props.dataField\n                }\n              }\n            }\n          });\n        }\n\n        listQuery = {\n          bool: {\n            should: should\n          }\n        };\n      } else {\n        var _type2, _listQuery;\n\n        listQuery = (_listQuery = {}, _listQuery[type] = (_type2 = {}, _type2[props.dataField] = value, _type2), _listQuery);\n      }\n    } else {\n      // adds a sub-query with must as an array of objects for each term/value\n      var queryArray = value.map(function (item) {\n        var _type3, _ref2;\n\n        return _ref2 = {}, _ref2[type] = (_type3 = {}, _type3[props.dataField] = item, _type3), _ref2;\n      });\n      listQuery = {\n        bool: {\n          must: queryArray\n        }\n      };\n    }\n\n    query = value.length ? listQuery : null;\n  }\n\n  if (query && props.nestedField) {\n    return {\n      query: {\n        nested: {\n          path: props.nestedField,\n          query: query\n        }\n      }\n    };\n  }\n\n  return query;\n};\n\nvar _initialiseProps = function _initialiseProps() {\n  var _this3 = this;\n\n  this.setReact = function (props) {\n    var react = props.react;\n\n    if (react) {\n      var newReact = (0, _helper.pushToAndClause)(react, _this3.internalComponent);\n      props.watchComponent(props.componentId, newReact);\n    } else {\n      props.watchComponent(props.componentId, {\n        and: _this3.internalComponent\n      });\n    }\n  };\n\n  this.setValue = function (value) {\n    var isDefaultValue = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n    var props = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : _this3.props; // ignore state updates when component is locked\n\n    if (props.beforeValueChange && _this3.locked) {\n      return;\n    }\n\n    _this3.locked = true;\n    var selectAllLabel = _this3.props.selectAllLabel;\n    var currentValue = _this3.state.currentValue;\n    var finalValues = null;\n\n    if (selectAllLabel && value.includes(selectAllLabel)) {\n      if (currentValue[selectAllLabel]) {\n        currentValue = {};\n        finalValues = [];\n      } else {\n        _this3.state.options.forEach(function (item) {\n          currentValue[item.key] = true;\n        });\n\n        currentValue[selectAllLabel] = true;\n        finalValues = [selectAllLabel];\n      }\n    } else if (isDefaultValue) {\n      finalValues = value;\n      currentValue = {};\n\n      if (value) {\n        value.forEach(function (item) {\n          currentValue[item] = true;\n        });\n      }\n\n      if (selectAllLabel && selectAllLabel in currentValue) {\n        var _currentValue = currentValue,\n            del = _currentValue[selectAllLabel],\n            obj = _objectWithoutProperties(_currentValue, [selectAllLabel]);\n\n        currentValue = _extends({}, obj);\n      }\n    } else {\n      if (currentValue[value]) {\n        var _currentValue2 = currentValue,\n            _del = _currentValue2[value],\n            rest = _objectWithoutProperties(_currentValue2, [value]);\n\n        currentValue = _extends({}, rest);\n      } else {\n        currentValue[value] = true;\n      }\n\n      if (selectAllLabel && selectAllLabel in currentValue) {\n        var _currentValue3 = currentValue,\n            _del2 = _currentValue3[selectAllLabel],\n            _obj = _objectWithoutProperties(_currentValue3, [selectAllLabel]);\n\n        currentValue = _extends({}, _obj);\n      }\n\n      finalValues = Object.keys(currentValue);\n    }\n\n    var performUpdate = function performUpdate() {\n      _this3.setState({\n        currentValue: currentValue\n      }, function () {\n        _this3.updateQuery(finalValues, props);\n\n        _this3.locked = false;\n        if (props.onValueChange) props.onValueChange(finalValues);\n      });\n    };\n\n    (0, _helper.checkValueChange)(props.componentId, finalValues, props.beforeValueChange, performUpdate);\n  };\n\n  this.updateQuery = function (value, props) {\n    var query = props.customQuery || MultiDropdownList.defaultQuery;\n    props.updateQuery({\n      componentId: props.componentId,\n      query: query(value, props),\n      value: value,\n      label: props.filterLabel,\n      showFilter: props.showFilter,\n      URLParams: props.URLParams,\n      componentType: 'MULTIDROPDOWNLIST'\n    });\n  };\n\n  this.updateQueryOptions = function (props) {\n    var addAfterKey = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false; // when using composite aggs flush the current options for a fresh query\n\n    if (props.showLoadMore && !addAfterKey) {\n      _this3.setState({\n        options: []\n      });\n    } // for a new query due to other changes don't append after to get fresh results\n\n\n    var queryOptions = MultiDropdownList.generateQueryOptions(props, addAfterKey ? _this3.state.after : {});\n    props.setQueryOptions(_this3.internalComponent, queryOptions);\n  };\n\n  this.handleLoadMore = function () {\n    _this3.updateQueryOptions(_this3.props, true);\n  };\n};\n\nMultiDropdownList.propTypes = {\n  addComponent: _types2.default.funcRequired,\n  removeComponent: _types2.default.funcRequired,\n  setQueryListener: _types2.default.funcRequired,\n  setQueryOptions: _types2.default.funcRequired,\n  updateQuery: _types2.default.funcRequired,\n  watchComponent: _types2.default.funcRequired,\n  options: _types2.default.options,\n  selectedValue: _types2.default.selectedValue,\n  // component props\n  beforeValueChange: _types2.default.func,\n  className: _types2.default.string,\n  componentId: _types2.default.stringRequired,\n  customQuery: _types2.default.func,\n  dataField: _types2.default.stringRequired,\n  defaultSelected: _types2.default.stringArray,\n  filterLabel: _types2.default.string,\n  innerClass: _types2.default.style,\n  isLoading: _types2.default.bool,\n  loader: _types2.default.title,\n  onQueryChange: _types2.default.func,\n  onValueChange: _types2.default.func,\n  placeholder: _types2.default.string,\n  queryFormat: _types2.default.queryFormatSearch,\n  react: _types2.default.react,\n  renderListItem: _types2.default.func,\n  transformData: _types2.default.func,\n  selectAllLabel: _types2.default.string,\n  showCount: _types2.default.bool,\n  showFilter: _types2.default.bool,\n  size: _types2.default.number,\n  sortBy: _types2.default.sortByWithCount,\n  style: _types2.default.style,\n  themePreset: _types2.default.themePreset,\n  title: _types2.default.title,\n  URLParams: _types2.default.bool,\n  showMissing: _types2.default.bool,\n  missingLabel: _types2.default.string,\n  showSearch: _types2.default.bool,\n  showLoadMore: _types2.default.bool,\n  loadMoreLabel: _types2.default.title,\n  nestedField: _types2.default.string\n};\nMultiDropdownList.defaultProps = {\n  className: null,\n  placeholder: 'Select values',\n  queryFormat: 'or',\n  showCount: true,\n  showFilter: true,\n  size: 100,\n  sortBy: 'count',\n  style: {},\n  URLParams: false,\n  showMissing: false,\n  missingLabel: 'N/A',\n  showSearch: false,\n  showLoadMore: false,\n  loadMoreLabel: 'Load More'\n};\n\nvar mapStateToProps = function mapStateToProps(state, props) {\n  return {\n    options: props.nestedField && state.aggregations[props.componentId] ? state.aggregations[props.componentId].reactivesearch_nested : state.aggregations[props.componentId],\n    selectedValue: state.selectedValues[props.componentId] && state.selectedValues[props.componentId].value || null,\n    isLoading: state.isLoading[props.componentId],\n    themePreset: state.config.themePreset\n  };\n};\n\nvar mapDispatchtoProps = function mapDispatchtoProps(dispatch) {\n  return {\n    addComponent: function addComponent(component) {\n      return dispatch((0, _actions.addComponent)(component));\n    },\n    removeComponent: function removeComponent(component) {\n      return dispatch((0, _actions.removeComponent)(component));\n    },\n    setQueryOptions: function setQueryOptions(component, props) {\n      return dispatch((0, _actions.setQueryOptions)(component, props));\n    },\n    setQueryListener: function setQueryListener(component, onQueryChange, beforeQueryChange) {\n      return dispatch((0, _actions.setQueryListener)(component, onQueryChange, beforeQueryChange));\n    },\n    updateQuery: function updateQuery(updateQueryObject) {\n      return dispatch((0, _actions.updateQuery)(updateQueryObject));\n    },\n    watchComponent: function watchComponent(component, react) {\n      return dispatch((0, _actions.watchComponent)(component, react));\n    }\n  };\n};\n\nexports.default = (0, _utils2.connect)(mapStateToProps, mapDispatchtoProps)(MultiDropdownList);","map":{"version":3,"sources":["C:/Users/porto/info340-code/pod/340/node_modules/@appbaseio/reactivesearch/lib/components/list/MultiDropdownList.js"],"names":["exports","__esModule","_emotion","require","_extends","Object","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","_react","_react2","_interopRequireDefault","_actions","_helper","_types","_types2","_utils","_Title","_Title2","_Container","_Container2","_Button","_Button2","_Dropdown","_Dropdown2","_utils2","obj","default","_objectWithoutProperties","keys","indexOf","_classCallCheck","instance","Constructor","TypeError","_possibleConstructorReturn","self","ReferenceError","_inherits","subClass","superClass","create","constructor","value","enumerable","writable","configurable","setPrototypeOf","__proto__","MultiDropdownList","_Component","props","_this","_initialiseProps","state","currentValue","options","after","isLastBucket","locked","internalComponent","componentId","setQueryListener","onQueryChange","componentWillMount","addComponent","updateQueryOptions","setReact","selectedValue","setValue","defaultSelected","componentWillReceiveProps","nextProps","_this2","checkPropChange","react","showLoadMore","dataField","buckets","nextOptions","concat","map","bucket","doc_count","after_key","setState","checkSomePropChange","updateQuery","selectAllLabel","filter","val","isEqual","componentWillUnmount","removeComponent","generateQueryOptions","queryOptions","getQueryOptions","getCompositeAggsQuery","getAggsQuery","render","_props","loadMoreLabel","selectAll","isLoading","loader","createElement","style","className","title","getClassName","innerClass","items","item","String","trim","onChange","selectedItem","placeholder","labelField","multi","showCount","themePreset","renderListItem","showSearch","transformData","footer","css","loadMoreContainer","onClick","handleLoadMore","Component","defaultQuery","query","type","queryFormat","Array","isArray","includes","showMissing","match_all","exists","field","listQuery","_type","_ref","hasMissingTerm","missingLabel","should","bool","must_not","_type2","_listQuery","queryArray","_type3","_ref2","must","nestedField","nested","path","_this3","newReact","pushToAndClause","watchComponent","and","isDefaultValue","undefined","beforeValueChange","finalValues","forEach","_currentValue","del","_currentValue2","_del","rest","_currentValue3","_del2","_obj","performUpdate","onValueChange","checkValueChange","customQuery","label","filterLabel","showFilter","URLParams","componentType","addAfterKey","setQueryOptions","propTypes","funcRequired","func","string","stringRequired","stringArray","queryFormatSearch","size","number","sortBy","sortByWithCount","defaultProps","mapStateToProps","aggregations","reactivesearch_nested","selectedValues","config","mapDispatchtoProps","dispatch","component","beforeQueryChange","updateQueryObject","connect"],"mappings":"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","sourcesContent":["'use strict';\n\nexports.__esModule = true;\n\nvar _emotion = require('emotion');\n\nvar _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _actions = require('@appbaseio/reactivecore/lib/actions');\n\nvar _helper = require('@appbaseio/reactivecore/lib/utils/helper');\n\nvar _types = require('@appbaseio/reactivecore/lib/utils/types');\n\nvar _types2 = _interopRequireDefault(_types);\n\nvar _utils = require('./utils');\n\nvar _Title = require('../../styles/Title');\n\nvar _Title2 = _interopRequireDefault(_Title);\n\nvar _Container = require('../../styles/Container');\n\nvar _Container2 = _interopRequireDefault(_Container);\n\nvar _Button = require('../../styles/Button');\n\nvar _Button2 = _interopRequireDefault(_Button);\n\nvar _Dropdown = require('../shared/Dropdown');\n\nvar _Dropdown2 = _interopRequireDefault(_Dropdown);\n\nvar _utils2 = require('../../utils');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _objectWithoutProperties(obj, keys) { var target = {}; for (var i in obj) { if (keys.indexOf(i) >= 0) continue; if (!Object.prototype.hasOwnProperty.call(obj, i)) continue; target[i] = obj[i]; } return target; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar MultiDropdownList = function (_Component) {\n\t_inherits(MultiDropdownList, _Component);\n\n\tfunction MultiDropdownList(props) {\n\t\t_classCallCheck(this, MultiDropdownList);\n\n\t\tvar _this = _possibleConstructorReturn(this, _Component.call(this, props));\n\n\t\t_initialiseProps.call(_this);\n\n\t\t_this.state = {\n\t\t\tcurrentValue: {},\n\t\t\toptions: [],\n\t\t\tafter: {}, // for composite aggs\n\t\t\tisLastBucket: false\n\t\t};\n\t\t_this.locked = false;\n\t\t_this.internalComponent = props.componentId + '__internal';\n\t\tprops.setQueryListener(props.componentId, props.onQueryChange, null);\n\t\treturn _this;\n\t}\n\n\tMultiDropdownList.prototype.componentWillMount = function componentWillMount() {\n\t\tthis.props.addComponent(this.internalComponent);\n\t\tthis.props.addComponent(this.props.componentId);\n\t\tthis.updateQueryOptions(this.props);\n\n\t\tthis.setReact(this.props);\n\n\t\tif (this.props.selectedValue) {\n\t\t\tthis.setValue(this.props.selectedValue, true);\n\t\t} else if (this.props.defaultSelected) {\n\t\t\tthis.setValue(this.props.defaultSelected, true);\n\t\t}\n\t};\n\n\tMultiDropdownList.prototype.componentWillReceiveProps = function componentWillReceiveProps(nextProps) {\n\t\tvar _this2 = this;\n\n\t\t(0, _helper.checkPropChange)(this.props.react, nextProps.react, function () {\n\t\t\treturn _this2.setReact(nextProps);\n\t\t});\n\t\t(0, _helper.checkPropChange)(this.props.options, nextProps.options, function () {\n\t\t\tvar showLoadMore = nextProps.showLoadMore,\n\t\t\t    dataField = nextProps.dataField;\n\t\t\tvar options = _this2.state.options;\n\n\t\t\tif (showLoadMore) {\n\t\t\t\t// append options with showLoadMore\n\t\t\t\tvar buckets = nextProps.options[dataField].buckets;\n\n\t\t\t\tvar nextOptions = [].concat(options, buckets.map(function (bucket) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tkey: bucket.key[dataField],\n\t\t\t\t\t\tdoc_count: bucket.doc_count\n\t\t\t\t\t};\n\t\t\t\t}));\n\t\t\t\tvar after = nextProps.options[dataField].after_key;\n\t\t\t\t// detect the last bucket by checking if the next set of buckets were empty\n\t\t\t\tvar isLastBucket = !buckets.length;\n\t\t\t\t_this2.setState({\n\t\t\t\t\tafter: {\n\t\t\t\t\t\tafter: after\n\t\t\t\t\t},\n\t\t\t\t\tisLastBucket: isLastBucket,\n\t\t\t\t\toptions: nextOptions\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\t_this2.setState({\n\t\t\t\t\toptions: nextProps.options[nextProps.dataField] ? nextProps.options[nextProps.dataField].buckets : []\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\t(0, _helper.checkSomePropChange)(this.props, nextProps, ['size', 'sortBy'], function () {\n\t\t\treturn _this2.updateQueryOptions(nextProps);\n\t\t});\n\n\t\t(0, _helper.checkPropChange)(this.props.dataField, nextProps.dataField, function () {\n\t\t\t_this2.updateQueryOptions(nextProps);\n\t\t\t_this2.updateQuery(Object.keys(_this2.state.currentValue), nextProps);\n\t\t});\n\n\t\tvar selectedValue = Object.keys(this.state.currentValue);\n\n\t\tif (this.props.selectAllLabel) {\n\t\t\tselectedValue = selectedValue.filter(function (val) {\n\t\t\t\treturn val !== _this2.props.selectAllLabel;\n\t\t\t});\n\n\t\t\tif (this.state.currentValue[this.props.selectAllLabel]) {\n\t\t\t\tselectedValue = [this.props.selectAllLabel];\n\t\t\t}\n\t\t}\n\n\t\tif (!(0, _helper.isEqual)(this.props.defaultSelected, nextProps.defaultSelected)) {\n\t\t\tthis.setValue(nextProps.defaultSelected, true);\n\t\t} else if (!(0, _helper.isEqual)(selectedValue, nextProps.selectedValue)) {\n\t\t\tthis.setValue(nextProps.selectedValue || [], true);\n\t\t}\n\t};\n\n\tMultiDropdownList.prototype.componentWillUnmount = function componentWillUnmount() {\n\t\tthis.props.removeComponent(this.props.componentId);\n\t\tthis.props.removeComponent(this.internalComponent);\n\t};\n\n\tMultiDropdownList.generateQueryOptions = function generateQueryOptions(props, after) {\n\t\tvar queryOptions = (0, _helper.getQueryOptions)(props);\n\t\treturn props.showLoadMore ? (0, _utils.getCompositeAggsQuery)(queryOptions, props, after) : (0, _utils.getAggsQuery)(queryOptions, props);\n\t};\n\n\tMultiDropdownList.prototype.render = function render() {\n\t\tvar _props = this.props,\n\t\t    showLoadMore = _props.showLoadMore,\n\t\t    loadMoreLabel = _props.loadMoreLabel;\n\t\tvar isLastBucket = this.state.isLastBucket;\n\n\t\tvar selectAll = [];\n\n\t\tif (this.props.isLoading && this.props.loader) {\n\t\t\treturn this.props.loader;\n\t\t}\n\n\t\tif (this.state.options.length === 0) {\n\t\t\treturn null;\n\t\t}\n\n\t\tif (this.props.selectAllLabel) {\n\t\t\tselectAll = [{\n\t\t\t\tkey: this.props.selectAllLabel\n\t\t\t}];\n\t\t}\n\t\treturn _react2.default.createElement(\n\t\t\t_Container2.default,\n\t\t\t{ style: this.props.style, className: this.props.className },\n\t\t\tthis.props.title && _react2.default.createElement(\n\t\t\t\t_Title2.default,\n\t\t\t\t{ className: (0, _helper.getClassName)(this.props.innerClass, 'title') || null },\n\t\t\t\tthis.props.title\n\t\t\t),\n\t\t\t_react2.default.createElement(_Dropdown2.default, {\n\t\t\t\tinnerClass: this.props.innerClass,\n\t\t\t\titems: [].concat(selectAll, this.state.options.filter(function (item) {\n\t\t\t\t\treturn String(item.key).trim().length;\n\t\t\t\t}).map(function (item) {\n\t\t\t\t\treturn _extends({}, item, { key: String(item.key) });\n\t\t\t\t})),\n\t\t\t\tonChange: this.setValue,\n\t\t\t\tselectedItem: this.state.currentValue,\n\t\t\t\tplaceholder: this.props.placeholder,\n\t\t\t\tlabelField: 'key',\n\t\t\t\tmulti: true,\n\t\t\t\tshowCount: this.props.showCount,\n\t\t\t\tthemePreset: this.props.themePreset,\n\t\t\t\trenderListItem: this.props.renderListItem,\n\t\t\t\tshowSearch: this.props.showSearch,\n\t\t\t\ttransformData: this.props.transformData,\n\t\t\t\tfooter: showLoadMore && !isLastBucket && _react2.default.createElement(\n\t\t\t\t\t'div',\n\t\t\t\t\t{\n\t\t\t\t\t\tclassName: (0, _emotion.css)(_Button.loadMoreContainer)\n\t\t\t\t\t},\n\t\t\t\t\t_react2.default.createElement(\n\t\t\t\t\t\t_Button2.default,\n\t\t\t\t\t\t{ onClick: this.handleLoadMore },\n\t\t\t\t\t\tloadMoreLabel\n\t\t\t\t\t)\n\t\t\t\t)\n\t\t\t})\n\t\t);\n\t};\n\n\treturn MultiDropdownList;\n}(_react.Component);\n\nMultiDropdownList.defaultQuery = function (value, props) {\n\tvar query = null;\n\tvar type = props.queryFormat === 'or' ? 'terms' : 'term';\n\n\tif (!Array.isArray(value) || value.length === 0) {\n\t\treturn null;\n\t}\n\n\tif (props.selectAllLabel && value.includes(props.selectAllLabel)) {\n\t\tif (props.showMissing) {\n\t\t\tquery = { match_all: {} };\n\t\t} else {\n\t\t\tquery = {\n\t\t\t\texists: {\n\t\t\t\t\tfield: props.dataField\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t} else if (value) {\n\t\tvar listQuery = void 0;\n\t\tif (props.queryFormat === 'or') {\n\t\t\tif (props.showMissing) {\n\t\t\t\tvar _type, _ref;\n\n\t\t\t\tvar hasMissingTerm = value.includes(props.missingLabel);\n\t\t\t\tvar should = [(_ref = {}, _ref[type] = (_type = {}, _type[props.dataField] = value.filter(function (item) {\n\t\t\t\t\treturn item !== props.missingLabel;\n\t\t\t\t}), _type), _ref)];\n\t\t\t\tif (hasMissingTerm) {\n\t\t\t\t\tshould = should.concat({\n\t\t\t\t\t\tbool: {\n\t\t\t\t\t\t\tmust_not: {\n\t\t\t\t\t\t\t\texists: { field: props.dataField }\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tlistQuery = {\n\t\t\t\t\tbool: {\n\t\t\t\t\t\tshould: should\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tvar _type2, _listQuery;\n\n\t\t\t\tlistQuery = (_listQuery = {}, _listQuery[type] = (_type2 = {}, _type2[props.dataField] = value, _type2), _listQuery);\n\t\t\t}\n\t\t} else {\n\t\t\t// adds a sub-query with must as an array of objects for each term/value\n\t\t\tvar queryArray = value.map(function (item) {\n\t\t\t\tvar _type3, _ref2;\n\n\t\t\t\treturn _ref2 = {}, _ref2[type] = (_type3 = {}, _type3[props.dataField] = item, _type3), _ref2;\n\t\t\t});\n\t\t\tlistQuery = {\n\t\t\t\tbool: {\n\t\t\t\t\tmust: queryArray\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\tquery = value.length ? listQuery : null;\n\t}\n\n\tif (query && props.nestedField) {\n\t\treturn {\n\t\t\tquery: {\n\t\t\t\tnested: {\n\t\t\t\t\tpath: props.nestedField,\n\t\t\t\t\tquery: query\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\treturn query;\n};\n\nvar _initialiseProps = function _initialiseProps() {\n\tvar _this3 = this;\n\n\tthis.setReact = function (props) {\n\t\tvar react = props.react;\n\n\t\tif (react) {\n\t\t\tvar newReact = (0, _helper.pushToAndClause)(react, _this3.internalComponent);\n\t\t\tprops.watchComponent(props.componentId, newReact);\n\t\t} else {\n\t\t\tprops.watchComponent(props.componentId, {\n\t\t\t\tand: _this3.internalComponent\n\t\t\t});\n\t\t}\n\t};\n\n\tthis.setValue = function (value) {\n\t\tvar isDefaultValue = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n\t\tvar props = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : _this3.props;\n\n\t\t// ignore state updates when component is locked\n\t\tif (props.beforeValueChange && _this3.locked) {\n\t\t\treturn;\n\t\t}\n\n\t\t_this3.locked = true;\n\t\tvar selectAllLabel = _this3.props.selectAllLabel;\n\t\tvar currentValue = _this3.state.currentValue;\n\n\t\tvar finalValues = null;\n\n\t\tif (selectAllLabel && value.includes(selectAllLabel)) {\n\t\t\tif (currentValue[selectAllLabel]) {\n\t\t\t\tcurrentValue = {};\n\t\t\t\tfinalValues = [];\n\t\t\t} else {\n\t\t\t\t_this3.state.options.forEach(function (item) {\n\t\t\t\t\tcurrentValue[item.key] = true;\n\t\t\t\t});\n\t\t\t\tcurrentValue[selectAllLabel] = true;\n\t\t\t\tfinalValues = [selectAllLabel];\n\t\t\t}\n\t\t} else if (isDefaultValue) {\n\t\t\tfinalValues = value;\n\t\t\tcurrentValue = {};\n\t\t\tif (value) {\n\t\t\t\tvalue.forEach(function (item) {\n\t\t\t\t\tcurrentValue[item] = true;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (selectAllLabel && selectAllLabel in currentValue) {\n\t\t\t\tvar _currentValue = currentValue,\n\t\t\t\t    del = _currentValue[selectAllLabel],\n\t\t\t\t    obj = _objectWithoutProperties(_currentValue, [selectAllLabel]);\n\n\t\t\t\tcurrentValue = _extends({}, obj);\n\t\t\t}\n\t\t} else {\n\t\t\tif (currentValue[value]) {\n\t\t\t\tvar _currentValue2 = currentValue,\n\t\t\t\t    _del = _currentValue2[value],\n\t\t\t\t    rest = _objectWithoutProperties(_currentValue2, [value]);\n\n\t\t\t\tcurrentValue = _extends({}, rest);\n\t\t\t} else {\n\t\t\t\tcurrentValue[value] = true;\n\t\t\t}\n\n\t\t\tif (selectAllLabel && selectAllLabel in currentValue) {\n\t\t\t\tvar _currentValue3 = currentValue,\n\t\t\t\t    _del2 = _currentValue3[selectAllLabel],\n\t\t\t\t    _obj = _objectWithoutProperties(_currentValue3, [selectAllLabel]);\n\n\t\t\t\tcurrentValue = _extends({}, _obj);\n\t\t\t}\n\t\t\tfinalValues = Object.keys(currentValue);\n\t\t}\n\n\t\tvar performUpdate = function performUpdate() {\n\t\t\t_this3.setState({\n\t\t\t\tcurrentValue: currentValue\n\t\t\t}, function () {\n\t\t\t\t_this3.updateQuery(finalValues, props);\n\t\t\t\t_this3.locked = false;\n\t\t\t\tif (props.onValueChange) props.onValueChange(finalValues);\n\t\t\t});\n\t\t};\n\n\t\t(0, _helper.checkValueChange)(props.componentId, finalValues, props.beforeValueChange, performUpdate);\n\t};\n\n\tthis.updateQuery = function (value, props) {\n\t\tvar query = props.customQuery || MultiDropdownList.defaultQuery;\n\n\t\tprops.updateQuery({\n\t\t\tcomponentId: props.componentId,\n\t\t\tquery: query(value, props),\n\t\t\tvalue: value,\n\t\t\tlabel: props.filterLabel,\n\t\t\tshowFilter: props.showFilter,\n\t\t\tURLParams: props.URLParams,\n\t\t\tcomponentType: 'MULTIDROPDOWNLIST'\n\t\t});\n\t};\n\n\tthis.updateQueryOptions = function (props) {\n\t\tvar addAfterKey = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n\n\t\t// when using composite aggs flush the current options for a fresh query\n\t\tif (props.showLoadMore && !addAfterKey) {\n\t\t\t_this3.setState({\n\t\t\t\toptions: []\n\t\t\t});\n\t\t}\n\t\t// for a new query due to other changes don't append after to get fresh results\n\t\tvar queryOptions = MultiDropdownList.generateQueryOptions(props, addAfterKey ? _this3.state.after : {});\n\t\tprops.setQueryOptions(_this3.internalComponent, queryOptions);\n\t};\n\n\tthis.handleLoadMore = function () {\n\t\t_this3.updateQueryOptions(_this3.props, true);\n\t};\n};\n\nMultiDropdownList.propTypes = {\n\taddComponent: _types2.default.funcRequired,\n\tremoveComponent: _types2.default.funcRequired,\n\tsetQueryListener: _types2.default.funcRequired,\n\tsetQueryOptions: _types2.default.funcRequired,\n\tupdateQuery: _types2.default.funcRequired,\n\twatchComponent: _types2.default.funcRequired,\n\toptions: _types2.default.options,\n\tselectedValue: _types2.default.selectedValue,\n\t// component props\n\tbeforeValueChange: _types2.default.func,\n\tclassName: _types2.default.string,\n\tcomponentId: _types2.default.stringRequired,\n\tcustomQuery: _types2.default.func,\n\tdataField: _types2.default.stringRequired,\n\tdefaultSelected: _types2.default.stringArray,\n\tfilterLabel: _types2.default.string,\n\tinnerClass: _types2.default.style,\n\tisLoading: _types2.default.bool,\n\tloader: _types2.default.title,\n\tonQueryChange: _types2.default.func,\n\tonValueChange: _types2.default.func,\n\tplaceholder: _types2.default.string,\n\tqueryFormat: _types2.default.queryFormatSearch,\n\treact: _types2.default.react,\n\trenderListItem: _types2.default.func,\n\ttransformData: _types2.default.func,\n\tselectAllLabel: _types2.default.string,\n\tshowCount: _types2.default.bool,\n\tshowFilter: _types2.default.bool,\n\tsize: _types2.default.number,\n\tsortBy: _types2.default.sortByWithCount,\n\tstyle: _types2.default.style,\n\tthemePreset: _types2.default.themePreset,\n\ttitle: _types2.default.title,\n\tURLParams: _types2.default.bool,\n\tshowMissing: _types2.default.bool,\n\tmissingLabel: _types2.default.string,\n\tshowSearch: _types2.default.bool,\n\tshowLoadMore: _types2.default.bool,\n\tloadMoreLabel: _types2.default.title,\n\tnestedField: _types2.default.string\n};\n\nMultiDropdownList.defaultProps = {\n\tclassName: null,\n\tplaceholder: 'Select values',\n\tqueryFormat: 'or',\n\tshowCount: true,\n\tshowFilter: true,\n\tsize: 100,\n\tsortBy: 'count',\n\tstyle: {},\n\tURLParams: false,\n\tshowMissing: false,\n\tmissingLabel: 'N/A',\n\tshowSearch: false,\n\tshowLoadMore: false,\n\tloadMoreLabel: 'Load More'\n};\n\nvar mapStateToProps = function mapStateToProps(state, props) {\n\treturn {\n\t\toptions: props.nestedField && state.aggregations[props.componentId] ? state.aggregations[props.componentId].reactivesearch_nested : state.aggregations[props.componentId],\n\t\tselectedValue: state.selectedValues[props.componentId] && state.selectedValues[props.componentId].value || null,\n\t\tisLoading: state.isLoading[props.componentId],\n\t\tthemePreset: state.config.themePreset\n\t};\n};\n\nvar mapDispatchtoProps = function mapDispatchtoProps(dispatch) {\n\treturn {\n\t\taddComponent: function addComponent(component) {\n\t\t\treturn dispatch((0, _actions.addComponent)(component));\n\t\t},\n\t\tremoveComponent: function removeComponent(component) {\n\t\t\treturn dispatch((0, _actions.removeComponent)(component));\n\t\t},\n\t\tsetQueryOptions: function setQueryOptions(component, props) {\n\t\t\treturn dispatch((0, _actions.setQueryOptions)(component, props));\n\t\t},\n\t\tsetQueryListener: function setQueryListener(component, onQueryChange, beforeQueryChange) {\n\t\t\treturn dispatch((0, _actions.setQueryListener)(component, onQueryChange, beforeQueryChange));\n\t\t},\n\t\tupdateQuery: function updateQuery(updateQueryObject) {\n\t\t\treturn dispatch((0, _actions.updateQuery)(updateQueryObject));\n\t\t},\n\t\twatchComponent: function watchComponent(component, react) {\n\t\t\treturn dispatch((0, _actions.watchComponent)(component, react));\n\t\t}\n\t};\n};\n\nexports.default = (0, _utils2.connect)(mapStateToProps, mapDispatchtoProps)(MultiDropdownList);"]},"metadata":{},"sourceType":"script"}